!function(e){var t={};function s(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=e,s.c=t,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(r,i,function(t){return e[t]}.bind(null,i));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=13)}([function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(4),i=s(2);t.setState=function(e,t,s){const o=s.value;s.value=function(...e){const t=o.call(this,...e);return setTimeout(()=>{const e=i.artboard.svg.outerHTML;r.host.api.setState(e)},0),t}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(e,t,s){this.tag=e,this.listenerFn=t,this.senderFn=s,this.listeners=new Array,this.requestGuard=(e=>"object"==typeof e&&null!==e&&this.tag in e),this.responseGuard=(e=>"object"==typeof e&&null!==e&&this.tag in e)}makeGetRequest(e){return new Promise(t=>{const s=this.listenerFn(e=>{this.responseGuard(e)&&(s(),t(e[this.tag].response))}),r={[this.tag]:{get:e}};this.senderFn(r)})}makeSetRequest(e){const t={[this.tag]:{set:e}};this.senderFn(t)}listenGetRequest(e,t){const s=this.listenerFn(s=>{if(this.requestGuard(s)&&s[this.tag].get){const r=s[this.tag].get,i=e(r);if(i){const e=t(r,i),s={[this.tag]:{response:e}};this.senderFn(s)}}});this.listeners.push(s)}listenSetRequest(e,t){const s=this.listenerFn(s=>{if(this.requestGuard(s)&&s[this.tag].set){const r=s[this.tag].set,i=e(r);i&&t(r,i)}});this.listeners.push(s)}removeListeners(){this.listeners.forEach(e=>e()),this.listeners.length=0}}t.PipeEndpoint=r;t.Pipe=class{constructor(e){this.tag=e}createEndpoint(e,t){return new r(this.tag,e,t)}createListenerEndpoint(e){return new r(this.tag,e,()=>{})}createSenderEndpoint(e){return new r(this.tag,()=>()=>{},e)}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(19);t.artboard=new r.Artboard},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(29),i=s(2);t.zoom=new r.Zoom(i.artboard)},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(21);t.host=new r.VscodeHost},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(23),i=s(24),o=s(2),n=s(9),c=s(4),l=s(3),a=s(11);t.holder=new r.ElementHolder,t.picker=new i.Picker(o.artboard,t.holder,n.figuresCollection,c.host,l.zoom,a.userEventMan)},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(20),i=s(4);t.webviewEndpoint=new r.WebviewEndpoint(i.host)},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(8);t.updateSelection=function(e,t,s){const i=s.value;s.value=function(...e){const t=i.call(this,...e);return setTimeout(()=>{r.selection.update()},0),t}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(5),i=s(2),o=s(41),n=s(3);t.selection=new o.UserSelection(r.holder,r.picker,i.artboard,n.zoom)},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(25),i=s(26),o=s(27),n=s(28),c=s(2),l=s(3),a=s(30),u=s(31),h=s(32),d=s(33),p=s(34),f=s(10),b=s(11),m=s(38),g=s(39),v=s(40),w=new r.FiguresCollection;t.figuresCollection=w;const y=new d.DraggerValue(["x"],["y"],l.zoom),E=new d.DraggerValue(["cx"],["cy"],l.zoom),P=new d.DraggerValue(["x1","x2"],["y1","y2"],l.zoom),_=new g.DraggerPoints(l.zoom),M=new p.DraggerDelegate(w);w.add(new i.CircleFigure(E,c.artboard),new u.EllipseFigure(E,c.artboard),new o.RectFigure(y,c.artboard),new n.TextFigure(y,c.artboard),new a.GFigure(M,c.artboard),new h.LineFigure(P,c.artboard,l.zoom,f.cancelListener,b.userEventMan),new m.PolygonFigure(_,c.artboard,l.zoom,f.cancelListener,b.userEventMan),new v.PolylineFigure(_,c.artboard,l.zoom,f.cancelListener,b.userEventMan))},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(35),i=s(6),o=s(36);t.cancelListener=new r.CancelListener(i.webviewEndpoint,o.cancelPipe)},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(37);t.userEventMan=new r.UserEventManager},function(e,t,s){"use strict";var r=this&&this.__decorate||function(e,t,s,r){var i,o=arguments.length,n=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(n=(o<3?i(n):o>3?i(t,s,n):i(t,s))||n);return o>3&&n&&Object.defineProperty(t,s,n),n};Object.defineProperty(t,"__esModule",{value:!0});class i{constructor(e,t,s,r,i){this.drag=e,this.artboard=t,this.zoom=s,this.cancelListener=r,this.userEventMan=i,this.ctor=SVGElement}create(e,t){let s=Array();this.artboard.box.classList.add("interactive-points");let r=null;this.userEventMan.mode="interactive";const i=e=>{const{clientX:t,clientY:i,shiftKey:o}=e,{scrollLeft:n,scrollTop:c}=document.scrollingElement,l=[[t,n],[i,c]];if(s.length>0&&o){const[[e],[r]]=s[s.length-1];Math.abs(t-e)<Math.abs(i-r)?l[0]=[e,n]:l[1]=[r,c]}s.push(l),r instanceof Function&&(r(),r=null),r=this.renderTools(s)};window.addEventListener("click",i);const o=()=>{window.removeEventListener("click",i),this.cancelListener.removeCallback(o),this.artboard.box.classList.remove("interactive-points"),r instanceof Function&&(r(),r=null),this.userEventMan.mode="pick",this.render(s)};this.cancelListener.addCallback(o)}render(e){const t=document.createElementNS("http://www.w3.org/2000/svg",this.name);t.setAttribute("stroke",this.stroke),t.setAttribute("fill",this.fill),t.setAttribute("points",e.map(([[e,t],[s,r]])=>`${(e+t)/this.zoom.value},${(s+r)/this.zoom.value}`).join(" ")),this.artboard.svg.appendChild(t)}renderTools(e){const{scrollLeft:t,scrollTop:s}=document.scrollingElement,r=document.createElementNS("http://www.w3.org/2000/svg","svg"),i=this.artboard.svg.getBoundingClientRect(),o=parseInt(this.artboard.svg.getAttribute("width")),n=parseInt(this.artboard.svg.getAttribute("height"));r.setAttribute("width",String(this.zoom.value*o)),r.setAttribute("height",String(this.zoom.value*n)),Object.assign(r.style,{position:"absolute",top:i.top+s+"px",left:i.left+t+"px"}),this.artboard.tools.appendChild(r),e.forEach(([[t,s],[i,o]],n)=>{const c=document.createElementNS("http://www.w3.org/2000/svg","circle");if(c.setAttribute("cx",`${t+s}`),c.setAttribute("cy",`${i+o}`),c.setAttribute("r","3"),c.setAttribute("fill","none"),c.setAttribute("stroke","#777"),c.setAttribute("stroke-dasharray","1"),r.appendChild(c),n>0){const[[c,l],[a,u]]=e[n-1],h=document.createElementNS("http://www.w3.org/2000/svg","line"),d={stroke:"#777","stroke-dasharray":"1",x1:`${c+l}`,y1:`${a+u}`,x2:`${t+s}`,y2:`${i+o}`};Object.keys(d).forEach(e=>{const t=d[e];h.setAttribute(e,t)}),r.appendChild(h)}});let c=()=>{};if(e.length>0){const[[t,s],[i,o]]=e[e.length-1],n=document.createElementNS("http://www.w3.org/2000/svg","line");r.appendChild(n);const l={stroke:"#777","stroke-dasharray":"1",x1:`${t+s}`,y1:`${i+o}`,x2:`${t+s}`,y2:`${i+o}`};Object.keys(l).forEach(e=>{const t=l[e];n.setAttribute(e,t)});const a=e=>{const{clientX:r,clientY:c,shiftKey:l}=e,{scrollLeft:a,scrollTop:u}=document.scrollingElement,h={x2:`${r+a}`,y2:`${c+u}`};if(l){Math.abs(r-t)<Math.abs(c-i)?h.x2=`${t+s}`:h.y2=`${i+o}`}Object.keys(h).forEach(e=>{const t=h[e];n.setAttribute(e,t)})};window.addEventListener("mousemove",a),c=(()=>window.removeEventListener("mousemove",a))}return()=>{c(),this.artboard.tools.removeChild(r)}}}r([s(0).setState],i.prototype,"create",null),t.PolyFigure=i},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(14),i=s(15),o=s(16),n=s(17),c=s(18),l=s(2),a=s(6),u=s(22),h=s(43),d=s(44),p=s(45),f=s(46),b=s(47),m=s(48),g=s(49),v=s(50),w=s(51),y=s(52),E=s(5),P=s(3),_=s(9),M=s(8),A=s(53),j=s(10);E.picker.listen(),new f.ZoomListener(a.webviewEndpoint,r.zoomPipe,l.artboard,P.zoom).listen(),new h.ArtboardListener(a.webviewEndpoint,i.artboardPipe,l.artboard).listen(),new u.RemoteAttributeListener(a.webviewEndpoint,o.remoteAttributePipe,E.holder).listen(),new d.CreateListener(a.webviewEndpoint,n.createPipe,_.figuresCollection).listen(),new p.FlushListener(a.webviewEndpoint,c.flushPipe,l.artboard).listen(),new b.ArrangeListener(a.webviewEndpoint,m.arrangePipe,l.artboard,E.holder).listen(),new y.ElementListener(a.webviewEndpoint,g.elementPipe,E.holder).listen(),new A.GroupListener(a.webviewEndpoint,w.groupPipe,E.holder,l.artboard).listen(),j.cancelListener.listen();const O=a.webviewEndpoint.createFromPipe(v.pickPipe);E.holder.addListener(e=>{e.length>0?O.makeSetRequest({html:`selection: [${e.map(e=>[e.nodeName,e.id].filter(e=>e).join("#")).join(", ")}]`}):O.makeSetRequest({html:null})}),M.selection.listen(),P.zoom.addCallback(e=>{O.makeSetRequest({html:`zoom: ${Math.round(100*e)}%`})})},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(1);t.zoomPipe=new r.Pipe("zoom")},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(1);t.artboardPipe=new r.Pipe("artboard")},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(1);t.remoteAttributePipe=new r.Pipe("remoteAttribute")},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(1);t.CreatePipeRequest=class{constructor(e,t,s=!1){this.elementName=e,this.attributes=t,this.interactive=s}},t.createPipe=new r.Pipe("create")},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(1);t.flushPipe=new r.Pipe("flush")},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Artboard=class{constructor(){this.svgElement=null,this.containerHtmlElement=null,this.toolsElement=null}get svg(){return this.svgElement||(this.svgElement=document.querySelector("#artboard svg")),this.svgElement}get box(){return this.containerHtmlElement||(this.containerHtmlElement=document.querySelector("#artboard")),this.containerHtmlElement}get tools(){return this.toolsElement||(this.toolsElement=document.querySelector("#tools")),this.toolsElement}clearCache(){this.svgElement=null,this.containerHtmlElement=null,this.toolsElement=null}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.WebviewEndpoint=class{constructor(e){this.host=e}createFromPipe(e){return e.createEndpoint(e=>{const t=({data:t})=>e(t);return window.addEventListener("message",t),()=>window.removeEventListener("message",t)},e=>this.host.api.postMessage(e))}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.VscodeHost=class{constructor(){this.vscode=null}get api(){return this.vscode||(this.vscode=acquireVsCodeApi()),this.vscode}}},function(e,t,s){"use strict";var r=this&&this.__decorate||function(e,t,s,r){var i,o=arguments.length,n=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(n=(o<3?i(n):o>3?i(t,s,n):i(t,s))||n);return o>3&&n&&Object.defineProperty(t,s,n),n};Object.defineProperty(t,"__esModule",{value:!0});const i=s(0),o=s(7),n=s(42);class c{constructor(e,t,s){this.webviewEndpoint=e,this.remoteAttributePipe=t,this.holder=s,this.remoteAttributeClient=this.webviewEndpoint.createFromPipe(this.remoteAttributePipe)}listen(){this.remoteAttributeClient.listenGetRequest(e=>this.holder.elements,({attribute:e},t)=>{return{value:this.getAttribute(t[0],e)}}),this.remoteAttributeClient.listenSetRequest(e=>this.holder.elements,({attribute:e,value:t},s)=>{s.forEach(s=>{t?this.setAttribute(s,e,t):"string"==typeof t&&""===t.trim()&&this.removeAttribute(s,e)})})}getAttribute(e,t){switch(t){case"innerText":return e.innerHTML;default:return e.getAttribute(t)}}setAttribute(e,t,s){switch(t){case"innerText":e.innerHTML=s;break;default:e.setAttribute(t,s)}}removeAttribute(e,t){switch(t){case"innerText":e.innerHTML="";break;default:e.removeAttribute(t)}}}r([o.updateSelection,n.rehold,i.setState],c.prototype,"setAttribute",null),r([o.updateSelection,n.rehold,i.setState],c.prototype,"removeAttribute",null),t.RemoteAttributeListener=c},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ElementHolder=class{constructor(){this.box=Array(),this.callbacks=new Set}get elements(){return this.box}set elements(e){this.box=e,this.callbacks.forEach(t=>t(e))}addListener(e){return this.callbacks.add(e),()=>this.callbacks.delete(e)}}},function(e,t,s){"use strict";var r=this&&this.__decorate||function(e,t,s,r){var i,o=arguments.length,n=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(n=(o<3?i(n):o>3?i(t,s,n):i(t,s))||n);return o>3&&n&&Object.defineProperty(t,s,n),n};Object.defineProperty(t,"__esModule",{value:!0});class i{constructor(e,t,s,r,i,o){this.artboard=e,this.holder=t,this.figuresCollection=s,this.host=r,this.zoom=i,this.userEventMan=o,this.mousedownCallbacks=new Set,this.mousemoveCallbacks=new Set,this.mouseupCallbacks=new Set,this.bindedMousedown=this.onMousedown.bind(this),this.bindedMousemove=this.onMousemove.bind(this),this.bindedMouseup=this.onMouseup.bind(this)}onMousemove(e){const{clientX:t,clientY:s}=e;this.holder.elements.forEach(e=>{this.figuresCollection.delegate(e).drag.onMousemove(e,t,s)}),this.mousemoveCallbacks.forEach(t=>t(e))}onMousedown(e){if("interactive"===this.userEventMan.mode)return;let{target:t}=e;for(;t&&t instanceof SVGElement&&t.parentElement instanceof SVGGElement;)t=t.parentElement;if(this.figuresCollection.getFiltered("drag").map(e=>e.ctor).some(e=>t instanceof e)){const s=t,{elements:r}=this.holder;if(e.shiftKey?-1===r.indexOf(s)?this.holder.elements=r.concat(s):this.holder.elements=this.holder.elements.filter(e=>e!==s):-1===this.holder.elements.indexOf(s)?this.holder.elements=[s]:this.holder.elements=r,e.altKey){const e=s.outerHTML,t=document.createElementNS("http://www.w3.org/2000/svg","g");t.innerHTML=e;const r=t.children[0];this.artboard.svg.insertBefore(r,s)}const{clientX:i,clientY:o}=e;this.holder.elements.forEach(e=>{this.figuresCollection.delegate(e).drag.onMousedown(e,i,o)}),this.artboard.svg.addEventListener("mousemove",this.bindedMousemove)}else this.holder.elements=[];this.mousedownCallbacks.forEach(t=>t(e))}onMouseup(e){const{clientX:t,clientY:s}=e;this.holder.elements.forEach(e=>{this.figuresCollection.delegate(e).drag.onMouseup(e,t,s)}),this.artboard.svg.removeEventListener("mousemove",this.bindedMousemove),this.mouseupCallbacks.forEach(t=>t(e))}listen(){this.artboard.svg.addEventListener("mousedown",this.bindedMousedown),this.artboard.svg.addEventListener("mouseup",this.bindedMouseup)}addMousemoveCallback(e){return this.mousemoveCallbacks.add(e),()=>this.mousemoveCallbacks.delete(e)}addMousedownCallback(e){return this.mousedownCallbacks.add(e),()=>this.mousedownCallbacks.delete(e)}addMouseupCallback(e){return this.mouseupCallbacks.add(e),()=>this.mouseupCallbacks.delete(e)}}r([s(0).setState],i.prototype,"onMouseup",null),t.Picker=i},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.FiguresCollection=class{constructor(){this.types=new Set}add(...e){e.forEach(e=>this.types.add(e))}delegate(e){for(let t of this.types){if("object"==typeof e&&t.testByElement(e))return t;if("string"==typeof e&&t.name===e)return t}}getFiltered(e){return Array.from(this.types).filter(t=>!!t[e])}}},function(e,t,s){"use strict";var r=this&&this.__decorate||function(e,t,s,r){var i,o=arguments.length,n=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(n=(o<3?i(n):o>3?i(t,s,n):i(t,s))||n);return o>3&&n&&Object.defineProperty(t,s,n),n};Object.defineProperty(t,"__esModule",{value:!0});class i{constructor(e,t){this.drag=e,this.artboard=t,this.name="circle",this.ctor=SVGCircleElement}testByElement(e){return e instanceof SVGCircleElement}create(e,t){const s=this.artboard.svg,r=document.createElementNS("http://www.w3.org/2000/svg","circle");s.appendChild(r),r.setAttribute("cx","50"),r.setAttribute("cy","50"),r.setAttribute("r","30"),r.setAttribute("stroke","#ffffff"),r.setAttribute("fill","#ccc")}}r([s(0).setState],i.prototype,"create",null),t.CircleFigure=i},function(e,t,s){"use strict";var r=this&&this.__decorate||function(e,t,s,r){var i,o=arguments.length,n=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(n=(o<3?i(n):o>3?i(t,s,n):i(t,s))||n);return o>3&&n&&Object.defineProperty(t,s,n),n};Object.defineProperty(t,"__esModule",{value:!0});class i{constructor(e,t){this.drag=e,this.artboard=t,this.name="rect",this.ctor=SVGRectElement}create(e,t){const s=this.artboard.svg,r=document.createElementNS("http://www.w3.org/2000/svg","rect");s.appendChild(r),r.setAttribute("x","50"),r.setAttribute("y","50"),r.setAttribute("width","50"),r.setAttribute("height","50"),r.setAttribute("stroke","#ffffff"),r.setAttribute("fill","#ccc")}testByElement(e){return e instanceof SVGRectElement}}r([s(0).setState],i.prototype,"create",null),t.RectFigure=i},function(e,t,s){"use strict";var r=this&&this.__decorate||function(e,t,s,r){var i,o=arguments.length,n=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(n=(o<3?i(n):o>3?i(t,s,n):i(t,s))||n);return o>3&&n&&Object.defineProperty(t,s,n),n};Object.defineProperty(t,"__esModule",{value:!0});class i{constructor(e,t){this.drag=e,this.artboard=t,this.name="text",this.ctor=SVGTextElement}create(e,t){const s=this.artboard.svg,r=document.createElementNS("http://www.w3.org/2000/svg",this.name);s.appendChild(r),r.setAttribute("x","50"),r.setAttribute("y","50"),r.setAttribute("fill","#ccc"),r.setAttribute("style","font-family: sans-serif; font-size: 20px"),Object.keys(t).forEach(e=>{const s=t[e];switch(e){case"innerText":r.innerHTML=s;break;default:r.setAttribute(e,s)}})}testByElement(e){return e instanceof this.ctor}}r([s(0).setState],i.prototype,"create",null),t.TextFigure=i},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Zoom=class{constructor(e){this.artboard=e,this.zoom=1,this.callbacks=new Set}get value(){return this.zoom}update(e,t){e&&(this.zoom+=e),t&&(this.zoom=t),Object.assign(this.artboard.box.style,{transform:`scale(${this.zoom})`}),Object.assign(this.artboard.box.style,{position:"absolute",top:"0",left:"0"}),this.callbacks.forEach(e=>e(this.value))}addCallback(e){return this.callbacks.add(e),()=>this.callbacks.delete(e)}}},function(e,t,s){"use strict";var r=this&&this.__decorate||function(e,t,s,r){var i,o=arguments.length,n=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(n=(o<3?i(n):o>3?i(t,s,n):i(t,s))||n);return o>3&&n&&Object.defineProperty(t,s,n),n};Object.defineProperty(t,"__esModule",{value:!0});class i{constructor(e,t){this.drag=e,this.artboard=t,this.name="g",this.ctor=SVGGElement}create(e,t){const{svg:s}=this.artboard,r=document.createElementNS("http://www.w3.org/2000/svg","g");s.appendChild(r)}testByElement(e){return e instanceof SVGGElement}}r([s(0).setState],i.prototype,"create",null),t.GFigure=i},function(e,t,s){"use strict";var r=this&&this.__decorate||function(e,t,s,r){var i,o=arguments.length,n=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(n=(o<3?i(n):o>3?i(t,s,n):i(t,s))||n);return o>3&&n&&Object.defineProperty(t,s,n),n};Object.defineProperty(t,"__esModule",{value:!0});class i{constructor(e,t){this.drag=e,this.artboard=t,this.name="ellipse",this.ctor=SVGEllipseElement}testByElement(e){return e instanceof SVGEllipseElement}create(e,t){const s=this.artboard.svg,r=document.createElementNS("http://www.w3.org/2000/svg","ellipse");s.appendChild(r),r.setAttribute("cx","50"),r.setAttribute("cy","50"),r.setAttribute("rx","20"),r.setAttribute("ry","40"),r.setAttribute("stroke","#ffffff"),r.setAttribute("fill","#ccc")}}r([s(0).setState],i.prototype,"create",null),t.EllipseFigure=i},function(e,t,s){"use strict";var r=this&&this.__decorate||function(e,t,s,r){var i,o=arguments.length,n=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(n=(o<3?i(n):o>3?i(t,s,n):i(t,s))||n);return o>3&&n&&Object.defineProperty(t,s,n),n};Object.defineProperty(t,"__esModule",{value:!0});class i{constructor(e,t,s,r,i){this.drag=e,this.artboard=t,this.zoom=s,this.cancelListener=r,this.userEventMan=i,this.name="line",this.ctor=SVGLineElement}testByElement(e){return e instanceof SVGLineElement}create(e,t){let s=Array();this.artboard.box.classList.add("interactive-points");let r=null;this.userEventMan.mode="interactive";const i=e=>{let{clientX:t,clientY:i,shiftKey:n}=e;const{scrollLeft:c,scrollTop:l}=document.scrollingElement;if(1===s.length&&n){let[[e,r]]=s;e-=c,r-=l,Math.abs(t-e)<Math.abs(i-r)?t=s[0][0]-c:i=s[0][1]-l}if(s.push([t+c,i+l]),1===s.length){const[[e,t]]=s;r=this.createEditingSelection(e,t)}if(s.length>=2){o();const[[e,t],[r,i]]=s,n={x1:e,y1:t,x2:r,y2:i},c=document.createElementNS("http://www.w3.org/2000/svg","line");Object.keys(n).forEach(e=>{const t=n[e];c.setAttribute(e,`${Math.round(t/this.zoom.value)}`)}),c.setAttribute("stroke","#777"),this.artboard.svg.appendChild(c)}};window.addEventListener("click",i);const o=()=>{window.removeEventListener("click",i),this.cancelListener.removeCallback(o),this.artboard.box.classList.remove("interactive-points"),r&&this.artboard.tools.removeChild(r),this.userEventMan.mode="pick"};this.cancelListener.addCallback(o)}createEditingSelection(e,t){const{scrollLeft:s,scrollTop:r}=document.scrollingElement,i=document.createElementNS("http://www.w3.org/2000/svg","svg"),o=document.createElementNS("http://www.w3.org/2000/svg","circle"),n=document.createElementNS("http://www.w3.org/2000/svg","line"),c=this.artboard.svg.getBoundingClientRect(),l=parseInt(this.artboard.svg.getAttribute("width")),a=parseInt(this.artboard.svg.getAttribute("height"));i.setAttribute("width",String(this.zoom.value*l)),i.setAttribute("height",String(this.zoom.value*a)),o.setAttribute("fill","none"),o.setAttribute("stroke","#777"),o.setAttribute("stroke-dasharray","1"),o.setAttribute("r","3"),o.setAttribute("cx",`${e}`),o.setAttribute("cy",`${t}`),n.setAttribute("x1",`${e}`),n.setAttribute("y1",`${t}`),n.setAttribute("x2",`${e}`),n.setAttribute("y2",`${t}`),n.setAttribute("stroke","#777"),n.setAttribute("stroke-dasharray","1");const u=i=>{let{clientX:o,clientY:c,shiftKey:l}=i;const a=e-s,u=t-r,h=Math.abs(o-a),d=Math.abs(c-u);l&&(h<d?o=e-s:c=t-r),n.setAttribute("x2",`${o+s}`),n.setAttribute("y2",`${c+r}`)},h=e=>{window.removeEventListener("mousemove",u),window.removeEventListener("click",h)};return window.addEventListener("mousemove",u),window.addEventListener("click",h),Object.assign(i.style,{position:"absolute",top:c.top+r+"px",left:c.left+s+"px"}),this.artboard.tools.appendChild(i),i.appendChild(o),i.appendChild(n),i}}r([s(0).setState],i.prototype,"create",null),t.LineFigure=i},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DraggerValue=class{constructor(e,t,s){this.xAttrs=e,this.yAttrs=t,this.zoom=s,this.attrsStore=new Map}onMousedown(e,t,s){this.attrsStore.set(e,Object.assign({},this.xAttrs.reduce((s,r)=>(s[r]=this.getValueAttr(e,r,t),s),{}),this.yAttrs.reduce((t,r)=>(t[r]=this.getValueAttr(e,r,s),t),{})))}onMousemove(e,t,s){const r=this.attrsStore.get(e);this.xAttrs.forEach(s=>{const i=Math.round((t-r[s])/this.zoom.value);e.setAttribute(s,`${i}`)}),this.yAttrs.forEach(t=>{const i=Math.round((s-r[t])/this.zoom.value);e.setAttribute(t,`${i}`)})}onMouseup(e,t,s){this.attrsStore.delete(e)}getValueAttr(e,t,s){return Math.round(s-(parseInt(e.getAttribute(t))||0)*this.zoom.value)}setValueAttr(e,t,s,r){const i=Math.round((r-s)/this.zoom.value);e.setAttribute(t,`${i}`)}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DraggerDelegate=class{constructor(e){this.figuresCollection=e}onMousedown(e,t,s){Array.from(e.children).forEach(e=>{const r=this.figuresCollection.delegate(e);r&&r.drag.onMousedown(e,t,s)})}onMousemove(e,t,s){Array.from(e.children).forEach(e=>{const r=this.figuresCollection.delegate(e);r&&r.drag.onMousemove(e,t,s)})}onMouseup(e,t,s){Array.from(e.children).forEach(e=>{const r=this.figuresCollection.delegate(e);r&&r.drag.onMouseup(e,t,s)})}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CancelListener=class{constructor(e,t){this.webviewEndpoint=e,this.cancelPipe=t,this.callbacks=new Set,this.endpoint=this.webviewEndpoint.createFromPipe(this.cancelPipe)}listen(){this.endpoint.listenSetRequest(e=>!0,(e,t)=>{this.callbacks.forEach(e=>e())})}addCallback(e){this.callbacks.add(e)}removeCallback(e){this.callbacks.delete(e)}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(1);t.cancelPipe=new r.Pipe("cancel")},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.UserEventManager=class{constructor(){this.mode="pick"}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(12);t.PolygonFigure=class extends r.PolyFigure{constructor(){super(...arguments),this.name="polygon",this.ctor=SVGPolygonElement,this.stroke="#777",this.fill="#555"}testByElement(e){return e instanceof this.ctor}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DraggerPoints=class{constructor(e){this.zoom=e,this.pointsStore=new Map}onMousedown(e,t,s){this.pointsStore.set(e,e.getAttribute("points").split(/\s/).map(e=>e.trim().split(",").map(e=>parseInt(e))).map(([e,r])=>[Math.round(t-e*this.zoom.value),Math.round(s-r*this.zoom.value)]))}onMousemove(e,t,s){const r=this.pointsStore.get(e).map(([e,r])=>[Math.round((t-e)/this.zoom.value),Math.round((s-r)/this.zoom.value)]).map(e=>e.join(",")).join(" ");e.setAttribute("points",r)}onMouseup(e,t,s){}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(12);t.PolylineFigure=class extends r.PolyFigure{constructor(){super(...arguments),this.name="polyline",this.ctor=SVGPolylineElement,this.stroke="#777",this.fill="none"}testByElement(e){return e instanceof this.ctor}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.UserSelection=class{constructor(e,t,s,r){this.holder=e,this.picker=t,this.artboard=s,this.zoom=r,this.svg=null,this.rect=null,this.x=0,this.y=0,this.mousedownListener=null,this.mouseupListener=null,this.mousemoveListener=null}listen(){this.holder.addListener(e=>{const t=this.artboard.tools;this.svg&&(t.removeChild(this.svg),this.svg=null,this.rect=null),e.length>0&&(this.svg=self.document.createElementNS("http://www.w3.org/2000/svg","svg"),this.rect=self.document.createElementNS("http://www.w3.org/2000/svg","rect"),t.appendChild(this.svg),this.svg.appendChild(this.rect),this.update(),this.mousedownListener=this.picker.addMousedownCallback(({clientX:e,clientY:t})=>{this.x=e,this.y=t}),this.mousemoveListener=this.picker.addMousemoveCallback(({clientX:e,clientY:t})=>{const s=e-this.x,r=t-this.y;if(this.rect){const e=parseInt(this.rect.getAttribute("y"))+r,t=parseInt(this.rect.getAttribute("x"))+s;this.rect.setAttribute("y",String(e)),this.rect.setAttribute("x",String(t))}this.x=e,this.y=t}),this.mouseupListener=this.picker.addMouseupCallback(e=>{this.x=0,this.y=0,this.mousedownListener instanceof Function&&this.mousedownListener(),this.mousemoveListener instanceof Function&&this.mousemoveListener(),this.mouseupListener instanceof Function&&this.mouseupListener()}))})}update(){const e=this.holder.elements;if(e.length>0){const t=e.map(e=>e.getBoundingClientRect()),s=t.map(e=>e.left).reduce((e,t)=>t<e?t:e,window.innerWidth),r=t.map(e=>e.top).reduce((e,t)=>t<e?t:e,window.innerHeight),i=t.map(e=>e.right).reduce((e,t)=>t>e?t:e,0),o=t.map(e=>e.bottom).reduce((e,t)=>t>e?t:e,0);if(this.svg&&this.rect){const{scrollLeft:e,scrollTop:t}=document.scrollingElement,n=this.artboard.svg.getBoundingClientRect(),c=parseInt(this.artboard.svg.getAttribute("width")),l=parseInt(this.artboard.svg.getAttribute("height"));this.svg.setAttribute("width",String(this.zoom.value*c)),this.svg.setAttribute("height",String(this.zoom.value*l)),Object.assign(this.svg.style,{position:"absolute",top:n.top+document.scrollingElement.scrollTop+"px",left:n.left+document.scrollingElement.scrollLeft+"px"}),this.rect.setAttribute("x",String(s-2+e)),this.rect.setAttribute("y",String(r-2+t)),this.rect.setAttribute("width",String(i-s+3)),this.rect.setAttribute("height",String(o-r+3)),this.rect.setAttribute("fill","none"),this.rect.setAttribute("stroke","#777"),this.rect.setAttribute("stroke-width","1"),this.rect.setAttribute("stroke-dasharray","1")}}else this.destroy()}destroy(){this.svg&&(this.artboard.tools.removeChild(this.svg),this.svg=null,this.rect=null),this.mousedownListener instanceof Function&&this.mousedownListener(),this.mousemoveListener instanceof Function&&this.mousemoveListener(),this.mouseupListener instanceof Function&&this.mouseupListener()}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(5);t.rehold=function(e,t,s){const i=s.value;s.value=function(...e){const t=i.call(this,...e);return setTimeout(()=>{r.holder.elements=[...r.holder.elements]},0),t}}},function(e,t,s){"use strict";var r=this&&this.__decorate||function(e,t,s,r){var i,o=arguments.length,n=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(n=(o<3?i(n):o>3?i(t,s,n):i(t,s))||n);return o>3&&n&&Object.defineProperty(t,s,n),n};Object.defineProperty(t,"__esModule",{value:!0});class i{constructor(e,t,s){this.webviewEndpoint=e,this.artboardPipe=t,this.artboard=s,this.artboardClient=this.webviewEndpoint.createFromPipe(this.artboardPipe)}listen(){this.artboardClient.listenGetRequest(e=>this.artboard.svg,(e,t)=>{const{property:s}=e;return{value:t.getAttribute(s)}}),this.artboardClient.listenSetRequest(e=>this.artboard.svg,({property:e,value:t},s)=>{this.updateAttributes(s,e,t)})}updateAttributes(e,t,s){if(e.setAttribute(t,s),"width"===t||"height"===t){let[,,r,i]=e.getAttribute("viewBox").split(" ");"width"===t&&(r=s),"height"===t&&(i=s),e.setAttribute("viewBox",[0,0,r,i].join(" "))}}}r([s(0).setState],i.prototype,"updateAttributes",null),t.ArtboardListener=i},function(e,t,s){"use strict";var r=this&&this.__decorate||function(e,t,s,r){var i,o=arguments.length,n=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(n=(o<3?i(n):o>3?i(t,s,n):i(t,s))||n);return o>3&&n&&Object.defineProperty(t,s,n),n};Object.defineProperty(t,"__esModule",{value:!0});class i{constructor(e,t,s){this.webviewEndpoint=e,this.createPipe=t,this.figuresCollection=s,this.createClient=this.webviewEndpoint.createFromPipe(this.createPipe)}listen(){this.createClient.listenSetRequest(e=>!0,({elementName:e,attributes:t},s)=>{this.createElement(e,t)})}createElement(e,t){const s=this.figuresCollection.delegate(e);s&&s.create(e,t)}}r([s(0).setState],i.prototype,"createElement",null),t.CreateListener=i},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.FlushListener=class{constructor(e,t,s){this.webviewEndpoint=e,this.flushPipe=t,this.artboard=s,this.flushEndpoint=this.webviewEndpoint.createFromPipe(this.flushPipe)}listen(){this.flushEndpoint.listenGetRequest(e=>this.artboard.svg,({},e)=>({content:e.outerHTML}))}}},function(e,t,s){"use strict";var r=this&&this.__decorate||function(e,t,s,r){var i,o=arguments.length,n=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(n=(o<3?i(n):o>3?i(t,s,n):i(t,s))||n);return o>3&&n&&Object.defineProperty(t,s,n),n};Object.defineProperty(t,"__esModule",{value:!0});class i{constructor(e,t,s,r){this.webviewEndpoint=e,this.zoomPipe=t,this.artboard=s,this.zoom=r,this.zoomer=this.webviewEndpoint.createFromPipe(this.zoomPipe)}listen(){this.zoomer.listenSetRequest(e=>this.artboard.box,(e,t)=>{const{delta:s,abs:r}=e;this.updateZoom(s,r)})}updateZoom(e,t){this.zoom.update(e,t)}}r([s(7).updateSelection],i.prototype,"updateZoom",null),t.ZoomListener=i},function(e,t,s){"use strict";var r=this&&this.__decorate||function(e,t,s,r){var i,o=arguments.length,n=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(n=(o<3?i(n):o>3?i(t,s,n):i(t,s))||n);return o>3&&n&&Object.defineProperty(t,s,n),n};Object.defineProperty(t,"__esModule",{value:!0});class i{constructor(e,t,s,r){this.webviewEndpoint=e,this.arrangePipe=t,this.artboard=s,this.holder=r,this.arrangeClient=this.webviewEndpoint.createFromPipe(this.arrangePipe)}listen(){this.arrangeClient.listenSetRequest(e=>this.holder.elements,(e,t)=>{t.forEach(t=>{this.arrange(t,e)})})}arrange(e,t){switch(t){case"bringToFront":this.artboard.svg.appendChild(e);break;case"sendToBack":const{firstChild:s}=this.artboard.svg;s&&this.artboard.svg.insertBefore(e,s);break;case"moveForward":const{childNodes:r}=this.artboard.svg,i=r[Array.from(r).reduce((t,s,r)=>s===e?r:t,-1)+2];i?this.artboard.svg.insertBefore(e,i):this.artboard.svg.appendChild(e);break;case"moveBackward":const{childNodes:o}=this.artboard.svg,n=o[Array.from(o).reduce((t,s,r)=>s===e?r:t,-1)-1];n&&this.artboard.svg.insertBefore(e,n)}}}r([s(0).setState],i.prototype,"arrange",null),t.ArrangeListener=i},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(1);t.arrangePipe=new r.Pipe("arrange")},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(1);t.elementPipe=new r.Pipe("element")},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(1);t.pickPipe=new r.Pipe("pick")},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(1);t.groupPipe=new r.Pipe("group")},function(e,t,s){"use strict";var r=this&&this.__decorate||function(e,t,s,r){var i,o=arguments.length,n=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(n=(o<3?i(n):o>3?i(t,s,n):i(t,s))||n);return o>3&&n&&Object.defineProperty(t,s,n),n};Object.defineProperty(t,"__esModule",{value:!0});class i{constructor(e,t,s){this.webviewEndpoint=e,this.elementPipe=t,this.holder=s,this.elementReceiver=this.webviewEndpoint.createFromPipe(this.elementPipe)}listen(){this.elementReceiver.listenSetRequest(e=>this.holder.elements,(e,t)=>{t.forEach(t=>{this.applyCommand(e,t)}),this.holder.elements=[]})}applyCommand(e,t){switch(e){case"delete":t.remove()}}}r([s(0).setState],i.prototype,"applyCommand",null),t.ElementListener=i},function(e,t,s){"use strict";var r=this&&this.__decorate||function(e,t,s,r){var i,o=arguments.length,n=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(n=(o<3?i(n):o>3?i(t,s,n):i(t,s))||n);return o>3&&n&&Object.defineProperty(t,s,n),n};Object.defineProperty(t,"__esModule",{value:!0});class i{constructor(e,t,s,r){this.webviewEndpoinnt=e,this.groupPipe=t,this.holder=s,this.artboard=r,this.groupClient=this.webviewEndpoinnt.createFromPipe(this.groupPipe)}listen(){this.groupClient.listenSetRequest(e=>this.holder.elements.length>0,(e,t)=>{this.processCommand(e)})}processCommand(e){switch(e){case"group":this.group();break;case"ungroup":this.ungroup()}}group(){const e=document.createElementNS("http://www.w3.org/2000/svg","g");this.artboard.svg.appendChild(e),this.holder.elements.forEach(t=>e.appendChild(t)),this.holder.elements=[e]}ungroup(){this.holder.elements.filter(e=>e instanceof SVGGElement).forEach(e=>{const t=e.parentElement,s=Array.from(e.children);s.forEach(e=>{t.appendChild(e)}),t.removeChild(e),this.holder.elements=s})}}r([s(0).setState],i.prototype,"processCommand",null),t.GroupListener=i}]);